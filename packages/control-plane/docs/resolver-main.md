---
type: Documentation
domain: control-plane
last_modified: 2026-02-02
generated: true
source: packages/control-plane/cmd/resolver/main.go
generated_at: 2026-02-02T22:22:46.225201
hash: e53a85af9c11df19f7caa52717a03e4fe1f512958c414471e02e77ad2ada38bc
---

## GlassOps Control Plane Resolver Documentation

This document describes the functionality of the GlassOps Control Plane Resolver, a command-line tool responsible for validating deployments against defined policies. It acts as a gatekeeper, ensuring deployments adhere to quality and architectural standards before proceeding.

**Package Purpose:**

The `main` package implements the core logic for the resolver. It reads a deployment contract generated by the runtime environment, resolves a relevant policy, and then enforces rules based on that policy against the contract data. If the deployment does not meet the policy requirements, the resolver blocks further progress.

**Key Types:**

*   `contract.DeploymentContract`: This type, defined in the `github.com/glassops-platform/glassops-control-plane/internal/contract` package, represents the state of a deployment as reported by the runtime. It contains information about code coverage, static analysis results, and other quality metrics.
*   `policy.EffectivePolicy`: This type, defined in the `github.com/glassops-platform/glassops-control-plane/internal/policy` package, represents the resolved policy against which the deployment will be evaluated. It includes governance rules such as minimum code coverage and static analysis requirements.

**Important Functions:**

*   `main()`: This is the entry point of the resolver. It performs the following steps:
    1.  **Loads the Deployment Contract:** Reads the deployment contract from the file `.glassops/deployment-contract.json`.  An error is logged and the program exits if the file is not found.
    2.  **Resolves Policy:** Calls `policy.ResolvePolicy("devops-config.json", 80.0)` to load and resolve a policy from the `devops-config.json` file, using a floor of 80% for policy enforcement. The resolved policy is stored in the `effPolicy` variable.
    3.  **Enforces Code Coverage Policy:** Checks if the actual code coverage reported in the deployment contract (`dc.Quality.Coverage.Actual`) meets the minimum coverage requirement defined in the resolved policy (`effPolicy.Governance.MinCoverage`). If the coverage is insufficient, a message is printed to the console, and the program exits with a non-zero exit code (1).
    4.  **Enforces Static Analysis Policy:** Checks if static analysis is enabled in the resolved policy (`effPolicy.Governance.StaticAnalysis.Enabled`) and if the deployment contract indicates that static analysis passed (`dc.Quality.StaticAnalysis.Met`). If static analysis is enabled and has not passed, a message is printed to the console, including the tool used for static analysis, and the program exits with a non-zero exit code (1).
    5.  **Reports Success:** If all checks pass, a success message is printed to the console.

**Error Handling:**

The resolver employs basic error handling. Specifically:

*   File reading errors (when attempting to read the deployment contract) are handled by logging a fatal error message and exiting the program.
*   The `policy.ResolvePolicy` function's error return is currently ignored. We should consider handling this error in a production environment.
*   Policy violations result in informative error messages printed to the console, followed by program termination with a non-zero exit code.

**Concurrency:**

This version of the resolver does not employ concurrency (goroutines or channels). All operations are performed sequentially.

**Design Decisions:**

*   **Policy as Code:** The resolver leverages a policy-as-code approach, allowing governance rules to be defined and managed as configuration files.
*   **Contract-Based Governance:** The use of a deployment contract provides a standardized way for the runtime environment to communicate deployment state to the resolver.
*   **Fail-Fast Principle:** The resolver is designed to fail quickly if any policy violations are detected, preventing non-compliant deployments from proceeding.
*   **Configuration File Location:** The deployment contract is expected to be located at a fixed path (`.glassops/deployment-contract.json`). The policy file is also expected to be at a fixed path (`devops-config.json`). You may need to adjust these paths based on your environment.