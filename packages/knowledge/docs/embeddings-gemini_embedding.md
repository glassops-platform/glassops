---
type: Documentation
domain: knowledge
origin: packages/knowledge/embeddings/gemini_embedding.py
last_modified: 2026-01-26
generated: true
source: packages/knowledge/embeddings/gemini_embedding.py
generated_at: 2026-01-26T14:09:56.370Z
hash: 053cebf303284fec38a35a2ea4daa3ef6322588b57d640f57ad26e3209a89024
---

## Gemini Embedding Class Documentation

**Document Version:** 1.0

**Overview:**

The `GeminiEmbedding` class provides an interface for generating text embeddings using Googleâ€™s Gemini models via the `google.generativeai` library. Text embeddings are numerical representations of text that capture semantic meaning, enabling applications like semantic search, text similarity analysis, and recommendation systems. This class handles API key configuration, batch processing for efficiency, and graceful fallback mechanisms to ensure robustness.

**Dependencies:**

*   Python 3.7+
*   `google-generativeai` (optional, used for actual embedding generation)
*   `os` (for environment variable access)
*   `time` (not explicitly used, but often present in similar applications for rate limiting)
*   `warnings` (for suppressing deprecation warnings)
*   `random` (for mock data generation)

**Installation:**

If using the Gemini API, install the necessary package:

```bash
pip install google-generativeai
```

**Class Definition:**

```python
class GeminiEmbedding:
    def __init__(self):
        # Initializes the GeminiEmbedding class.
        # Sets up API key from environment variable.
        pass

    def get_embeddings(self, texts: list[str]) -> list[list[float]]:
        # Generates embeddings for a list of input texts.
        # Returns a list of embedding vectors (lists of floats).
        pass
```

**Initialization (`__init__`)**

*   The constructor attempts to retrieve the Google API key from the `GOOGLE_API_KEY` environment variable.
*   If the API key is not found, a warning message is printed, and the class will default to returning mock embedding data.
*   If the API key is found and the `google.generativeai` library is installed, the API key is configured for use with the Gemini API.

**`get_embeddings(texts: list[str])` Method**

This method is the primary interface for generating embeddings.

*   **Input:**
    *   `texts`: A list of strings, where each string represents the text to be embedded.
*   **Output:**
    *   A list of lists of floats. Each inner list represents the embedding vector for the corresponding input text.  Each embedding vector has a dimensionality of 768.
*   **Functionality:**
    1.  **API Key Check:** Verifies that the API key is available and the `google.generativeai` library is imported.
    2.  **Batch Embedding (Preferred):** Attempts to generate embeddings for all input texts in a single batch request to the Gemini API. This is the most efficient approach. The model used is `models/text-embedding-004`.
    3.  **Sequential Embedding (Fallback):** If batch embedding fails (due to API errors or SDK limitations), the method falls back to processing each text individually in a loop. This ensures that even if some texts fail to embed, the process continues for the remaining texts.  Error handling is included to catch individual chunk embedding failures, logging the error and providing a random vector as a placeholder to maintain alignment.
    4.  **Mock Embedding (No API Key):** If the API key is not set, the method generates random 768-dimensional vectors as mock embeddings. This allows for testing and development without requiring access to the Gemini API.
*   **Error Handling:** Includes `try...except` blocks to handle potential exceptions during API calls.  Errors during sequential embedding are logged, and a random vector is used as a fallback to prevent complete failure.
*   **SDK Compatibility:** The code includes logic to handle potential differences in the `google.generativeai` SDK, specifically regarding support for passing lists of texts directly to the `embed_content` method.

**Important Considerations:**

*   **API Key Security:**  The `GOOGLE_API_KEY` should be stored securely as an environment variable and not hardcoded in the application.
*   **Rate Limits:** The Gemini API has rate limits.  Consider implementing rate limiting mechanisms in your application to avoid exceeding these limits.
*   **Cost:** Using the Gemini API incurs costs.  Monitor your API usage and billing to avoid unexpected charges.
*   **Mock Data:** When running without a valid API key, the generated embeddings are random and should not be used for production applications. They are intended for testing and development purposes only.
*   **Embedding Dimensionality:** The embeddings generated by the `models/text-embedding-004` model have a dimensionality of 768.